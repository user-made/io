var q=Object.defineProperty;var z=(l,t,o)=>t in l?q(l,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):l[t]=o;var U=(l,t,o)=>z(l,typeof t!="symbol"?t+"":t,o);import{A as Y,b as k}from"./index-CCdNvfV5.js";import{d as T,o as n,c as d,j as u,t as v,V as L,b as V,G as W,F,C,f as w,W as X,X as B,r as b,Y as Z,w as H,S as f,I as a,B as I,z as M,N as E,u as i,l as S,Z as P}from"./index-CI1TXeFk.js";/* empty css                                                              */import{_ as x}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{p as J,d as K,a as Q}from"./index.vue_vue_type_style_index_0_scoped_f01006ee_lang-ijOL3OAg.js";import"./error-ByG0LKAC.js";const D={class:"product-tile"},R={class:"product-tile__name"},tt=T({__name:"index",props:{groupCtrl:{type:Object,required:!0},product:{type:Object,required:!0}},setup(l){return(t,o)=>(n(),d("div",D,[u("button",{class:"product-tile__btn",onClick:o[0]||(o[0]=()=>l.groupCtrl.publishClickProductEvent(l.product)),style:L({"background-image":`url(${l.product.imgUrl})`})},v(l.product.name),5),u("span",R,v(l.product.name),1)]))}}),et=x(tt,[["__scopeId","data-v-d39acfe3"]]),rt={class:"product-tile-group"},ct=T({__name:"index",props:{ctrl:{type:Object,required:!0}},setup(l){return V(()=>{}),W(()=>{}),(t,o)=>(n(),d("div",rt,[(n(!0),d(F,null,C(l.ctrl.products,(h,m)=>(n(),w(et,{class:"product-tile-group__tile",index:h.id,"group-ctrl":l.ctrl,product:h},null,8,["index","group-ctrl","product"]))),256))]))}}),ot=x(ct,[["__scopeId","data-v-2d658fe3"]]);class st{constructor(t){U(this,"clickProductEventSubscribers",[]);this.products=t}subscribeToClickProductEvent(t){this.clickProductEventSubscribers.push(t)}unsubscribeFromClickProductEvent(t){this.clickProductEventSubscribers=this.clickProductEventSubscribers.filter(o=>o!==t)}publishClickProductEvent(t){this.clickProductEventSubscribers.forEach(o=>o(t))}}const A=async l=>{const t=await X.listByIds(l);return t.successful?B.createSuccessful(t.value.reduce((o,h)=>(o[h.id]=h,o),{})):B.createFailed({},t.errorStack)},at={class:"heading2 mb-l center"},lt={class:"container"},nt={key:0,class:"section"},it={class:"section__title light-black"},ut={key:1,class:"center"},dt={key:1,class:"section section--rvd"},_t={class:"section__title light-black"},pt={class:"section--rvd__list"},ht=["src","alt"],ft=["href"],vt={key:2,class:"section section--followed-discussions"},mt={class:"section__title light-black"},kt=["src","alt"],gt=["href"],bt={key:3,class:"center"},St=T({__name:"index",setup(l){const t=b(),o=b(),h=b(),m=b({}),$=r=>{window.location.href=E.buildProductUrl(r.wsFid,r.fid)},N=()=>{J.list().then(r=>{if(!r.successful){f.handleErrorStack(r.errorStack,a.failedToFetchData());return}r.value.length&&I.listByIds(r.value.map(e=>e.pid)).then(e=>{if(!e.successful){f.handleErrorStack(e.errorStack,a.failedToFetchData());return}t.value=new st(e.value),t.value.subscribeToClickProductEvent($)})})},O=()=>{K.listMine().then(r=>{if(!r.successful){f.handleErrorStack(r.errorStack,a.failedToFetchData());return}r.value.length&&M.listByIds(r.value.map(e=>e.did)).then(e=>{if(!e.successful){f.handleErrorStack(e.errorStack,a.failedToFetchData());return}const s=k.toMap(e.value,"id");I.listByIds(e.value.map(c=>c.pid)).then(c=>{if(!c.successful){f.handleErrorStack(c.errorStack,a.failedToFetchData());return}const y=k.toMap(c.value,"id");o.value=r.value.sort((_,p)=>p.visitedAt>_.visitedAt?1:-1).map(_=>{const p=s.get(_.did.toString());if(!p)return null;const g=y.get(p.pid.toString());return g?{d:p,p:g}:null}).filter(_=>_!==null)}),A(k.removeUndefined(e.value.map(c=>c.creatorId))).then(c=>{if(!c.successful){f.handleErrorStack(c.errorStack,a.failedToFetchData());return}m.value={...m.value,...c.value}})})})},j=()=>{Q.list().then(r=>{if(!r.successful){f.handleErrorStack(r.errorStack,a.failedToFetchData());return}r.value.length&&M.listByIds(r.value.map(e=>e.did)).then(e=>{if(!e.successful){f.handleErrorStack(e.errorStack,a.failedToFetchData());return}const s=k.toMap(e.value,"id");I.listByIds(e.value.map(c=>c.pid)).then(c=>{if(!c.successful){f.handleErrorStack(c.errorStack,a.failedToFetchData());return}const y=k.toMap(c.value,"id");h.value=r.value.sort((_,p)=>p.createdAt>_.createdAt?1:-1).map(_=>{const p=s.get(_.did.toString());if(!p)return null;const g=y.get(p.pid.toString());return g?{d:p,p:g}:null}).filter(_=>_!==null)}),A(k.removeUndefined(e.value.map(c=>c.creatorId))).then(c=>{if(!c.successful){f.handleErrorStack(c.errorStack,a.failedToFetchData());return}m.value={...m.value,...c.value}})})})},G=Z(()=>{var r,e,s;return!((r=t.value)!=null&&r.products.length)&&!((e=o.value)!=null&&e.length)&&!((s=h.value)!=null&&s.length)});return V(()=>{N(),O(),j()}),(r,e)=>(n(),w(Y,{"zen-right-bar":!0},{default:H(()=>[u("h2",at,v(i(a).search()),1),u("div",lt,[t.value?(n(),d("section",nt,[u("h3",it,v(i(a).recentlyViewedProducts()),1),t.value.products.length>0?(n(),w(ot,{key:0,ctrl:t.value},null,8,["ctrl"])):(n(),d("p",ut,v(i(a).nothingYet()),1))])):S("",!0),o.value&&o.value.length>0?(n(),d("section",dt,[u("h3",_t,v(i(a).recentlyViewedDiscussions()),1),u("ul",pt,[(n(!0),d(F,null,C(o.value,s=>(n(),d("li",{key:s.d.id,class:"section--rvd__list__item"},[u("img",{src:s.d.creatorId?m.value[s.d.creatorId].imgUrl:i(P),alt:i(a).profileImgOf(i(a).discussionCreator()),class:"section--rvd__list__item__img"},null,8,ht),u("a",{href:i(E).buildDiscussionUrl(s.p.wsFid,s.p.fid,s.d.id),class:"section--rvd__list__item__link"},v(s.d.title),9,ft)]))),128))])])):S("",!0),h.value&&h.value.length>0?(n(),d("section",vt,[u("h3",mt,v(i(a).followedDiscussions()),1),u("ul",null,[(n(!0),d(F,null,C(o.value,s=>(n(),d("li",{key:s.d.id,class:"section--followed-discussions__list__item"},[u("img",{src:s.d.creatorId?m.value[s.d.creatorId].imgUrl:i(P),alt:i(a).profileImgOf(i(a).discussionCreator()),class:"section--followed-discussions__list__item__img"},null,8,kt),u("a",{href:i(E).buildDiscussionUrl(s.p.wsFid,s.p.fid,s.d.id),class:"section--followed-discussions__list__item__link"},v(s.d.title),9,gt)]))),128))])])):S("",!0),G.value?(n(),d("p",bt,v(i(a).noContentYet()),1)):S("",!0)])]),_:1}))}}),xt=x(St,[["__scopeId","data-v-bd55c61c"]]);export{xt as default};
