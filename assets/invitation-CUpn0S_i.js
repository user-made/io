var B=Object.defineProperty;var T=(i,e,t)=>e in i?B(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var c=(i,e,t)=>T(i,typeof e!="symbol"?e+"":e,t);import{A as j}from"./index-CCdNvfV5.js";import{ac as y,ad as p,aa as C,X as w,a7 as F,d as $,$ as O,o as l,f as b,w as S,j as u,t as o,u as v,I as r,c as f,k as I,i as k,l as g,S as h,g as M,h as P,_ as V,J as D,M as H,ae as J,r as E,b as Q,af as U,a1 as W,a2 as q}from"./index-CI1TXeFk.js";import{P as L}from"./index-BsVT9ERs.js";import{B as X}from"./error-ByG0LKAC.js";import{_ as N}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index.vue_vue_type_style_index_0_scoped_f01006ee_lang-ijOL3OAg.js";class x{constructor(e,t,a,s,n,_){this.id=e,this.isAdmin=t,this.expireAt=a,this.oid=s,this.orgName=n,this.inviterEmail=_}get expired(){return this.expireAt<new Date}static create(e){return new x(e.id,e.isAdmin,new Date(e.expireAt),e.oid,e.orgName,e.inviterEmail)}}const Y=x.create({id:0,isAdmin:!1,expireAt:"",oid:0,orgName:"",inviterEmail:""}),d=class d{};c(d,"get",async e=>{const t=await y.get(`${d.path}/${e}`);if(!t.successful||!t.value.ok)return p.createFailed(Y,t.value,t.errorStack);const a=await t.value.json();return p.createSuccessful(x.create(a.invitation),t.value)}),c(d,"accept",async e=>{const t=await y.post(`${d.path}/accept`,{id:e});return!t.successful||!t.value.ok?p.createFailed(void 0,t.value,t.errorStack):p.createSuccessful(void 0,t.value)}),c(d,"path","/invitations");let m=d;class z extends C{constructor(){super(...arguments);c(this,"get",async t=>{const a=this.invitations.get(t);if(a)return w.createSuccessful(a);const s=await m.get(t);return s.successful?(this.invitations.set(s.value),w.createSuccessful(s.value)):s});c(this,"accept",async t=>{const a=await m.accept(t);return a.successful&&this.invitations.del(t),a});c(this,"invitations",F.createEmpty())}}const G=new z,R=G,K={class:"invitation"},Z={class:"invitation__owner-name"},tt={class:"invitation__inviter-label"},et={class:"invitation__inviter-value"},it={class:"invitation__expiration-label"},at={class:"invitation__expiration-value"},st={key:0,class:"invitation__action"},nt=$({__name:"invitation",props:{invitation:{type:Object,required:!0}},setup(i){const e=i;if(!O.getRouter())throw new Error("router is not set");const a=async()=>{const s=await R.accept(e.invitation.id);if(!s.successful){h.handleErrorStack(s.errorStack,r.failedToJoinOrg());return}M.add(P.createSuccess(r.joinedOrg()));const n=await V.listMines(!0);if(!n.successful){h.handleErrorStackQuietly(n.errorStack);return}const _=n.value.find(A=>A.id===e.invitation.oid);if(!_){h.handleErrorQuietly(D.createUiError("org not found"));return}H.setWs(_,{navigateTo:J.buildPath()})};return(s,n)=>(l(),b(L,null,{default:S(()=>[u("div",K,[u("div",Z,o(i.invitation.orgName),1),u("div",tt,o(v(r).inviter()),1),u("div",et,o(i.invitation.inviterEmail),1),u("div",it,o(v(r).invitationExpirationTime()),1),u("div",at,o(i.invitation.expireAt.toLocaleString()),1),i.invitation.expired?g("",!0):(l(),f("div",st,[I(X,{fat:!0,onClick:a},{default:S(()=>[k(o(v(r).join()),1)]),_:1})]))])]),_:1}))}}),ot=N(nt,[["__scopeId","data-v-db9b9f94"]]),rt=i=>(W("data-v-d9f46373"),i=i(),q(),i),ct={key:0,class:"container"},ut={key:0,class:"fs-xs"},lt={key:1,class:"fs-xs"},dt=rt(()=>u("br",null,null,-1)),vt={key:1,class:"expand flex-center fs-xs"},ft=$({__name:"invitation",setup(i){const e=U(),t=E(),a=E(!1);return Q(()=>{const s=Number(e.params.invitationId);R.get(s).then(n=>{if(!n.successful){if(n.errorStack.has404HttpError()){a.value=!0;return}h.handleErrorStack(n.errorStack);return}t.value=n.value})}),(s,n)=>(l(),b(j,null,{default:S(()=>[t.value?(l(),f("div",ct,[t.value.expired?(l(),f("div",ut,o(v(r).thisInvitationHasExpired()),1)):(l(),f("div",lt,[k(o(v(r).youAreInvited()),1),dt,k(o(v(r).doYouWantToJoin()),1)])),I(ot,{invitation:t.value},null,8,["invitation"])])):g("",!0),a.value?(l(),f("div",vt,o(v(r).couldNotFindTheInvitation()),1)):g("",!0)]),_:1}))}}),gt=N(ft,[["__scopeId","data-v-d9f46373"]]);export{gt as default};
