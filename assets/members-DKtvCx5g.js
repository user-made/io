var ue=Object.defineProperty;var de=(s,t,e)=>t in s?ue(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var u=(s,t,e)=>de(s,typeof t!="symbol"?t+"":t,e);import{c as me,S as z,A as ve,B as he}from"./index-CCdNvfV5.js";import{o as h,c as k,y as be,a4 as P,X as _,a5 as $,a6 as fe,a7 as J,d as x,f as p,u as r,I as l,w as S,j as a,t as b,k as d,a1 as j,a2 as H,i as O,a8 as _e,r as B,b as Se,_ as pe,S as v,M as ke,G as ge,a9 as Ee,F,C as T,l as K,g as M,h as V}from"./index-CI1TXeFk.js";import{C,I as E,g as Ce,b as we,B as R,a as $e,h as Be}from"./error-ByG0LKAC.js";import{m as N}from"./member-DMif3p8y.js";import{_ as A}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{D as Me}from"./date-DLmiVZsx.js";import{D as ee,B as q,b as Z}from"./index.vue_vue_type_style_index_0_scoped_f01006ee_lang-ijOL3OAg.js";import{P as te}from"./index-BsVT9ERs.js";class Ve{constructor(t){u(this,"name",ee.OrgNewMember);u(this,"org");u(this,"invite");this.org=t.org,this.invite=t.invite}}class xe{constructor(t){u(this,"name",ee.OrgDeleteMember);u(this,"org");u(this,"member");u(this,"deleteMember");this.org=t.org,this.member=t.member,this.deleteMember=t.deleteMember}}const Ae={},Le={class:"table-wrapper"};function De(s,t){return h(),k("div",Le,[be(s.$slots,"default",{},void 0,!0)])}const y=A(Ae,[["render",De],["__scopeId","data-v-2e8942ea"]]),n=class n{};u(n,"createBody",t=>{const e=P.create(t);return n.invitationBodies.set(e),n.publishListChangeEvent(t.oid,n.merge()),_.createSuccessful(e)}),u(n,"delete",async(t,e)=>{const m=await $.deleteInvitation(t,e);return m.successful&&(n.invitations.del(String(e)),n.publishListChangeEvent(t,n.merge())),m}),u(n,"invite",async t=>{const e=await $.invite(t);return e.successful?(n.invitations.setList(e.value),n.publishListChangeEvent(t.oid,n.merge()),_.createSuccessful(e.value)):_.createFailed([],e.errorStack)}),u(n,"sendInvitation",async t=>{const e=await $.invite({oid:t.oid,invitations:[t]});return e.successful?(n.invitations.setList(e.value),n.invitationBodies.del(t.email),n.publishListChangeEvent(t.oid,n.merge()),_.createSuccessful(e.value[0])):_.createFailed(fe,e.errorStack)}),u(n,"sendAllInvitations",async t=>{const e=await $.invite({oid:t,invitations:n.invitationBodies.list()});return e.successful&&(n.invitations.setList(e.value),n.invitationBodies.clear(),n.publishListChangeEvent(t,n.merge())),e}),u(n,"list",async t=>{if(n.invitations.exhaustive())return _.createSuccessful(n.merge());n.listPromise||(n.listPromise=$.listInvitations(t));const e=await n.listPromise;return e.successful?(n.invitations.setList(e.value,!0),_.createSuccessful(n.merge())):e}),u(n,"update",async t=>t.hasId?n.updateInvitation(t):n.updateBody(t)),u(n,"subscribeToListChangeEvent",t=>{n.changeEventSubscribers.push(t)}),u(n,"unsubscribeFromListChangeEvent",t=>{n.changeEventSubscribers=n.changeEventSubscribers.filter(e=>e!==t)}),u(n,"publishListChangeEvent",(t,e)=>{n.changeEventSubscribers.forEach(m=>m(t,e))}),u(n,"merge",()=>[...n.invitations.list(),...n.invitationBodies.list()]),u(n,"updateInvitation",async t=>{const e=await $.updateInvitation(t);return e.successful?(n.invitations.set(t),n.publishListChangeEvent(t.oid,n.merge()),_.createSuccessful(void 0)):e}),u(n,"updateBody",t=>(n.invitationBodies.set(t),n.publishListChangeEvent(t.oid,n.merge()),_.createSuccessful(void 0))),u(n,"invitations",J.createEmpty()),u(n,"invitationBodies",J.createEmpty({keyField:"email"})),u(n,"listPromise"),u(n,"changeEventSubscribers",[]);let f=n;const ne=x({__name:"invitation-status",props:{invitation:{type:Object,required:!0}},setup(s){const t=s,e=()=>t.invitation.hasId?t.invitation.expired?l.expired():l.invited():l.notInvitedYet(),m=()=>t.invitation.hasId?t.invitation.expired?q.Danger:q.Primary:q.Pink;return(w,L)=>(h(),p(me,{text:e(),color:m(),size:r(C).createS()},null,8,["text","color","size"]))}}),ze={class:"member"},Fe={class:"member__top"},Te={class:"member__top__name"},Ie={class:"member__top__email"},Ue={class:"member__bottom"},Ne={class:"member__bottom__is-admin"},qe={class:"member__bottom__is-admin__label"},Pe={class:"member__bottom__actions"},je="member-panel",He=x({__name:"member",props:{org:{type:Object,required:!0},member:{type:Object,required:!0}},setup(s){return(t,e)=>(h(),p(te,null,{default:S(()=>[a("div",ze,[a("div",Fe,[a("div",Te,b(s.member.name),1),a("div",Ie,b(s.member.email),1)]),a("div",Ue,[a("div",Ne,[a("div",qe,b(r(l).adminRole()),1),d(z,{id:je+`${s.member.uid}-is-admin`,size:r(C).createS(),"true-option":{label:r(l).have(),value:!0},"false-option":{label:r(l).notHave(),value:!1},modelValue:s.member.isAdmin,"onUpdate:modelValue":e[0]||(e[0]=m=>s.member.isAdmin=m)},null,8,["id","size","true-option","false-option","modelValue"])]),a("div",Pe,[d(E,{src:"/icon/person-remove.svg",alt:""})])])])]),_:1}))}}),We=A(He,[["__scopeId","data-v-b6e10c70"]]),Ge={class:"invitation"},Qe={class:"invitation__top"},Xe={class:"invitation__top__email"},Ye={class:"invitation__bottom"},Je={class:"invitation__bottom__is-admin"},Ke={class:"invitation__bottom__is-admin__label"},Ze={class:"invitation__bottom__actions"},ye="invitation-panel",Oe=x({__name:"invitation",props:{org:{type:Object,required:!0},invitation:{type:Object,required:!0},sendInvitation:{type:Function,required:!0},resendInvitation:{type:Function,required:!0},updateInvitation:{type:Function,required:!0},deleteInvitation:{type:Function,required:!0}},setup(s){return(t,e)=>(h(),p(te,null,{default:S(()=>[a("div",Ge,[a("div",Qe,[a("div",Xe,b(s.invitation.email),1),d(ne,{class:"invitation__top__badge",invitation:s.invitation},null,8,["invitation"])]),a("div",Ye,[a("div",Je,[a("div",Ke,b(r(l).adminRole()),1),d(z,{id:ye+`${s.invitation.email}-is-admin`,size:r(C).createS(),"true-option":{label:r(l).have(),value:!0},"false-option":{label:r(l).notHave(),value:!1},onInput:e[0]||(e[0]=()=>s.updateInvitation(s.invitation)),modelValue:s.invitation.isAdmin,"onUpdate:modelValue":e[1]||(e[1]=m=>s.invitation.isAdmin=m)},null,8,["id","size","true-option","false-option","modelValue"])]),a("div",Ze,[d(E,{src:"/icon/send.svg",alt:r(l).resendInvitation(),onClick:e[2]||(e[2]=()=>s.invitation.hasId?s.resendInvitation(s.invitation):s.sendInvitation(s.invitation))},null,8,["alt"]),d(E,{src:"/icon/person-remove.svg",alt:r(l).cancelInvitation(),onClick:e[3]||(e[3]=()=>s.deleteInvitation(s.invitation))},null,8,["alt"])])])])]),_:1}))}}),Re=A(Oe,[["__scopeId","data-v-1d5f2966"]]),et="/icon/add-white.svg",tt=s=>(j("data-v-65ae041d"),s=s(),H(),s),nt=tt(()=>a("img",{class:"add-btn__img",src:et},null,-1)),at=x({__name:"add",emits:["click"],setup(s,{emit:t}){return(e,m)=>(h(),p(R,{class:"add-btn",shape:r(Ce).Square,theme:r(we).Primary,size:r(C).createXL(),onClick:m[0]||(m[0]=w=>e.$emit("click"))},{default:S(()=>[nt]),_:1},8,["shape","theme","size"]))}}),st=A(at,[["__scopeId","data-v-65ae041d"]]),it="/icon/left-light-black.svg",lt=s=>(j("data-v-2ec1f199"),s=s(),H(),s),rt=lt(()=>a("img",{src:it},null,-1)),ct=x({__name:"index",props:{to:{type:String,required:!0},label:{type:String,required:!0}},setup(s){return(t,e)=>(h(),p(r(_e),{to:s.to,class:"inline-flex-v-center"},{default:S(()=>[rt,O(" "+b(s.label),1)]),_:1},8,["to"]))}}),ot=A(ct,[["__scopeId","data-v-2ec1f199"]]),U=s=>(j("data-v-1e0a4528"),s=s(),H(),s),ut={class:"heading2 mb-l center"},dt={key:0,class:"container block-s"},mt={class:"container__panels"},vt={class:"container block-td"},ht={class:"container__section"},bt=U(()=>a("th",null,null,-1)),ft={"data-actions":!0},_t={class:"container__section"},St={class:"container__section__sec-title"},pt=U(()=>a("th",null,null,-1)),kt=U(()=>a("th",null,null,-1)),gt={"data-shrink":!0},Et={"data-actions":!0},Ct={class:"flex-v-center-h-end"},wt=U(()=>a("td",null,null,-1)),$t={"data-actions":!0},Bt={class:"flex-v-center-h-end"},I="member-management",Mt=x({__name:"members",setup(s){const t=B([]),e=B(),m=B([]),w=B(!1),L=B(""),D=B([]),ae=c=>{if(!c){v.handleError(new Error("member-management: showNewMemberDialog: org is empty"));return}Z.push(new Ve({org:c,invite:f.invite}))},W=(c,o)=>{var i;console.log("onInvitationListChange",c,o),((i=e.value)==null?void 0:i.id)===c&&(D.value=o)},se=()=>D.value.some(c=>c instanceof P),ie=()=>{w.value=!1,L.value=""},le=()=>{if(!e.value){v.handleError(new Error("member-management: createInvitationBody: currentOrg is empty"));return}f.createBody({oid:e.value.id,email:L.value,isAdmin:w.value,expireAt:Me.twoWeeksFromNow().toISOString()}),ie()},G=async c=>{f.update(c).then(o=>{if(!o.successful){v.handleErrorStack(o.errorStack,l.failedToUpdateInvitation());return}M.add(V.createSuccess(l.invitationUpdated()))})},Q=async c=>{if(!e.value){v.handleError(new Error("member-management: createInvitationBody: currentOrg is empty"));return}c instanceof P||f.delete(e.value.id,c.id).then(o=>{if(!o.successful){v.handleErrorStack(o.errorStack,l.failedToCancelInvitation());return}M.add(V.createSuccess(l.invitationCancelled()))})},X=async c=>{f.invite({oid:c.oid,invitations:[c]}).then(o=>{if(!o.successful){v.handleErrorStack(o.errorStack,l.failedToResendInvitations());return}M.add(V.createSuccess(l.invitationResent()))})},Y=async c=>{if(!e.value){v.handleError(new Error("member-management: invite: currentOrg is empty"));return}f.sendInvitation(c).then(o=>{if(!o.successful){v.handleErrorStack(o.errorStack,l.failedToSendInvitations());return}M.add(V.createSuccess(l.invitationSent()))})},re=()=>{if(!e.value){v.handleError(new Error("member-management: invite: currentOrg is empty"));return}f.sendAllInvitations(e.value.id).then(c=>{if(!c.successful){v.handleErrorStack(c.errorStack,l.failedToSendInvitations());return}M.add(V.createSuccess(l.invitationSent()))})},ce=c=>{if(!e.value){v.handleError(new Error("member-management: showRemoveDialog: currentOrg is empty"));return}Z.push(new xe({org:e.value,member:c,deleteMember:N.deleteMember}))},oe=(c,o)=>{if(!e.value){v.handleError(new Error("member-management: updateAdminStatus: currentOrg is empty"));return}N.updateMember({oid:e.value.id,targetUid:c.uid,isAdmin:o}).then(i=>{if(!i.successful){v.handleErrorStack(i.errorStack,l.failedToUpdate());return}M.add(V.createSuccess(l.updated()))})};return Se(()=>{pe.listMines().then(c=>{if(!c.successful){v.handleErrorStack(c.errorStack);return}t.value=c.value;const o=ke.getWspIfOrg();if(!o.successful){v.handleErrorStackQuietly(o.errorStack);return}e.value=o.value,N.list(e.value.id).then(i=>{if(!i.successful){v.handleErrorStack(i.errorStack,l.failedToFetchData());return}m.value=i.value.map(g=>g.clone())}),f.list(e.value.id).then(i=>{if(!i.successful){v.handleErrorStack(i.errorStack,l.failedToFetchData());return}D.value=i.value})}),f.subscribeToListChangeEvent(W)}),ge(()=>{f.unsubscribeFromListChangeEvent(W)}),(c,o)=>(h(),p(ve,{"zen-right-bar":!0,"has-bottom-btn":!0},{default:S(()=>[d(ot,{to:r(Ee).buildPath(),label:r(l).org()},null,8,["to","label"]),a("h2",ut,b(r(l).manageMembers()),1),e.value?(h(),k("div",dt,[a("div",mt,[(h(!0),k(F,null,T(m.value,i=>(h(),p(We,{key:i.uid,org:e.value,member:i},null,8,["org","member"]))),128)),(h(!0),k(F,null,T(D.value,i=>(h(),p(Re,{key:i.email,org:e.value,invitation:i,"send-invitation":Y,"resend-invitation":X,"update-invitation":G,"delete-invitation":Q},null,8,["org","invitation"]))),128))]),d(st,{onClick:o[0]||(o[0]=()=>ae(e.value))})])):K("",!0),a("div",vt,[a("section",ht,[d(y,null,{default:S(()=>[a("table",null,[a("thead",null,[a("tr",null,[a("th",null,b(r(l).adminRole()),1),a("th",null,b(r(l).username()),1),a("th",null,b(r(l).email()),1),bt])]),a("tbody",null,[(h(!0),k(F,null,T(m.value,i=>(h(),k("tr",{key:i.uid},[a("td",null,[d(z,{id:I+`${i.uid}-is-admin`,size:r(C).createS(),"true-option":{label:r(l).have(),value:!0},"false-option":{label:r(l).notHave(),value:!1},modelValue:i.isAdmin,"onUpdate:modelValue":g=>i.isAdmin=g,onInput:g=>oe(i,g)},null,8,["id","size","true-option","false-option","modelValue","onUpdate:modelValue","onInput"])]),a("td",null,b(i.name),1),a("td",null,b(i.email),1),a("td",ft,[d(E,{src:"/icon/person-remove-light-black.svg","dark-src":"/icon/person-remove-silver.svg",alt:r(l).deleteMember(),onClick:()=>ce(i)},null,8,["alt","onClick"])])]))),128))])])]),_:1})]),a("section",_t,[a("h2",St,b(r(l).inviteNewMembers()),1),d(y,null,{default:S(()=>[a("table",null,[a("thead",null,[a("tr",null,[a("th",null,b(r(l).adminRole()),1),a("th",null,b(r(l).email()),1),pt,kt])]),a("tbody",null,[(h(!0),k(F,null,T(D.value,i=>(h(),k("tr",{key:i.email},[a("td",null,[d(z,{id:I+"-visibility",size:r(C).createS(),"true-option":{label:r(l).have(),value:!0},"false-option":{label:r(l).notHave(),value:!1},onInput:()=>G(i),modelValue:i.isAdmin,"onUpdate:modelValue":g=>i.isAdmin=g},null,8,["id","size","true-option","false-option","onInput","modelValue","onUpdate:modelValue"])]),a("td",null,b(i.email),1),a("td",gt,[d(ne,{invitation:i},null,8,["invitation"])]),a("td",Et,[a("div",Ct,[d(E,{src:"/icon/send-light-black.svg","dark-src":"/icon/send-silver.svg",alt:r(l).sendInvitation(),onClick:()=>i.hasId?X(i):Y(i)},null,8,["alt","onClick"]),i.hasId?(h(),p(E,{key:0,src:"/icon/person-remove-light-black.svg","dark-src":"/icon/person-remove-silver.svg",alt:r(l).cancelInvitation(),onClick:()=>Q(i)},null,8,["alt","onClick"])):K("",!0)])])]))),128)),a("tr",null,[a("td",null,[d(z,{id:I+"-visibility",size:r(C).createS(),"true-option":{label:r(l).have(),value:!0},"false-option":{label:r(l).notHave(),value:!1},modelValue:w.value,"onUpdate:modelValue":o[1]||(o[1]=i=>w.value=i)},null,8,["id","size","true-option","false-option","modelValue"])]),a("td",null,[d($e,{id:I+"-email",modelValue:L.value,"onUpdate:modelValue":o[2]||(o[2]=i=>L.value=i),spec:r(Be)},null,8,["id","modelValue","spec"])]),wt,a("td",$t,[a("div",Bt,[d(E,{src:"/icon/add-light-black.svg","dark-src":"/icon/add-silver.svg",alt:r(l).createInvitation(),onClick:le},null,8,["alt"])])])])])])]),_:1})]),d(he,{class:"container__form__action"},{default:S(()=>[d(R,{onClick:re,disabled:!se()},{default:S(()=>[O(b(r(l).inviteAll()),1)]),_:1},8,["disabled"])]),_:1})])]),_:1}))}}),Ut=A(Mt,[["__scopeId","data-v-1e0a4528"]]);export{Ut as default};
