var M=Object.defineProperty;var R=(c,e,o)=>e in c?M(c,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):c[e]=o;var i=(c,e,o)=>R(c,typeof e!="symbol"?e+"":e,o);import{A as q,T as P,l as V,B as Y,C}from"./index-CCdNvfV5.js";import{m as y,X as _,_ as L,a5 as U,I as t,d as W,r as p,b as z,S as m,f as T,w as h,o as u,j as n,t as l,u as a,c as g,l as b,F as j,C as G,k as v,i as A,J as D,A as E}from"./index-CI1TXeFk.js";import{C as H,B as w,b as x,f as S,A as J}from"./error-ByG0LKAC.js";import{D as Q,b as f,c as N}from"./index.vue_vue_type_style_index_0_scoped_f01006ee_lang-ijOL3OAg.js";import{_ as X}from"./_plugin-vue_export-helper-DlAUqK2U.js";class K{constructor(e){i(this,"name",Q.EditAccount);i(this,"account");i(this,"workspace");i(this,"requestOtp");i(this,"updateAccount");this.account=e.account,this.workspace=e.workspace,this.requestOtp=e.requestOtp,this.updateAccount=e.updateAccount}}const Z=async()=>{const c=await y.getAccount();if(!c.successful)return Promise.resolve(_.createFailed({deletable:!1},c.errorStack));const e=await L.listMines();if(!e.successful)return Promise.resolve(_.createFailed({deletable:!1},e.errorStack));const o=[];for(const d of e.value){const r=await U.listMembers({oid:d.id,admin:!0});if(!r.successful)return Promise.resolve(_.createFailed({deletable:!1},r.errorStack));r.value.some(k=>k.uid===c.value.id)&&r.value.length===1&&o.push(d)}return o.length>0?Promise.resolve(_.createSuccessful({deletable:!1,msg:t.cannotDeleteYourAccountBecauseYouAreTheOnlyAdminOfOrgs(o)})):Promise.resolve(_.createSuccessful({deletable:!0}))},$={class:"account"},ee={class:"heading2 mb-m center"},te={key:0,class:"account__items"},ae={class:"account__items__item"},se={class:"account__items__item__key"},oe={class:"account__items__item__val mt-xxs"},ce={class:"account__items__item__key"},ne={class:"account__items__item__val"},le={key:0,class:"account__items__item"},re={class:"account__items__item__key"},ie={class:"account__items__item__val"},ue=W({__name:"index",setup(c){const e=p(),o=p(),d=p(!0),r=p(),k=()=>{if(!e.value){m.handleError(D.createAccountNotFoundError());return}f.push(new K({account:e.value,requestOtp:E.requestOtp,updateAccount:y.updateAccount}))},O=()=>{if(d.value)f.push(new C({typ:N.Warning,title:t.confirmation(),msg:t.warningAboutDeletingTheAccount(),onYes:async()=>{const s=await E.deleteAccount();if(!s.successful){m.handleErrorStack(s.errorStack,t.failedToDelete());return}window.location.href="/"},onNo:()=>f.pop()}));else{if(!r.value){m.handleErrorQuietly(D.createUiError("deletableMsg is not set"));return}f.push(new C({typ:N.Info,title:t.conditionsNotMet(),msg:r.value,yesLabel:t.ok(),onYes:()=>f.pop()}))}};return z(()=>{y.getAccount().then(s=>{if(!s.successful){m.handleErrorStack(s.errorStack,t.failedToFetchData());return}e.value=s.value,o.value={id:"profile-img",src:s.value.imgUrl,alt:t.profileImg(),size:H.createM()}}),Z().then(s=>{if(!s.successful){m.handleErrorStack(s.errorStack,t.failedToFetchData());return}d.value=s.value.deletable,r.value=s.value.msg})}),(s,de)=>(u(),T(q,null,{default:h(()=>[n("div",$,[n("h2",ee,l(a(t).account()),1),e.value?(u(),g("dl",te,[n("div",ae,[n("dt",se,l(a(t).profileImg()),1),n("dd",oe,[o.value?(u(),T(P,{key:0,thumbnail:o.value},null,8,["thumbnail"])):b("",!0)])]),(u(!0),g(j,null,G(e.value.labeledNames,({label:B,name:F},I)=>(u(),g("div",{class:"account__items__item",key:I},[n("dt",ce,l(B),1),n("dd",ne,l(F),1)]))),128)),e.value.email?(u(),g("div",le,[n("dt",re,l(a(t).email()),1),n("dd",ie,l(e.value.email),1)])):b("",!0)])):b("",!0),v(Y,{"align-h":a(J).Left,class:"account__btn-group"},{default:h(()=>[v(w,{"head-icon":{src:"/icon/logout-light-black.svg",darkSrc:"/icon/logout-silver.svg"},theme:a(x).Text,"text-btn-underline-when":a(S).Never,onClick:a(V)},{default:h(()=>[A(l(a(t).logOut()),1)]),_:1},8,["theme","text-btn-underline-when","onClick"]),v(w,{"head-icon":{src:"/icon/edit-light-black.svg",darkSrc:"/icon/edit-silver.svg"},theme:a(x).Text,"text-btn-underline-when":a(S).Never,onClick:k},{default:h(()=>[A(l(a(t).edit()),1)]),_:1},8,["theme","text-btn-underline-when"]),v(w,{"head-icon":{src:"/icon/person-cancel-light-black.svg",darkSrc:"/icon/person-cancel-silver.svg"},theme:a(x).Text,"text-btn-underline-when":a(S).Never,onClick:O},{default:h(()=>[A(l(a(t).delete()),1)]),_:1},8,["theme","text-btn-underline-when"])]),_:1},8,["align-h"])])]),_:1}))}}),ve=X(ue,[["__scopeId","data-v-89f4030e"]]);export{ve as default};
